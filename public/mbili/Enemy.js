import { Tank } from './Tank.js';
import { red, darkGray } from './colors.js';

/**
 * üéÆ –ö–ª–∞—Å Enemy - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –≤–æ—Ä–æ–∂–æ–≥–æ —Ç–∞–Ω–∫–∞
 * 
 * –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞:
 * - –õ–æ–≥—ñ–∫—É –≤–æ—Ä–æ–∂–æ–≥–æ —Ç–∞–Ω–∫–∞
 * - –®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç
 */

export class Enemy extends Tank {
    constructor(options = {}, logger) {
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–ª–∞—Å—É Tank
        super({
            ...options, // –ø–µ—Ä–µ–¥–∞—î–º–æ –≤—Å—ñ –æ–ø—Ü—ñ—ó –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–º—É –∫–ª–∞—Å—É
            // —á–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
            color: options.color || red,
            // –≤–æ—Ä–æ–≥ —Ä—É—Ö–∞—î—Ç—å—Å—è –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ –∑–∞ –≥—Ä–∞–≤—Ü—è
            speed: options.speed || 1,
            // –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –Ω–∞–ø—Ä—è–º–æ–∫ –¥—É–ª–∞ –≤–Ω–∏–∑
            direction: options.direction || 'down'
        }, logger);
        
        // –∑–∞–ø–∏—Å—É—î–º–æ –≤ –ª–æ–≥
        this.logger.enemyAction('–í–æ—Ä–æ–≥ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π', `–ø–æ–∑–∏—Ü—ñ—è: (${this.x}, ${this.y})`);
    }
    
    /**
     * –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –≤–æ—Ä–æ–≥–∞
     * @param {number} deltaTime - –ß–∞—Å –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
     */
    update(deltaTime) {
        // –ü–æ–∫–∏ —â–æ –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å
        // –í –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —É—Ä–æ–∫–∞—Ö —Ç—É—Ç –±—É–¥–µ —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç –≤–æ—Ä–æ–≥–∞
    }
    
    /**
     * –ú–∞–ª—é–≤–∞–Ω–Ω—è –≤–æ—Ä–æ–≥–∞ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
     * @param {CanvasRenderingContext2D} ctx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
     */
    render(ctx) {
        // —è–∫—â–æ –≤–æ—Ä–æ–≥ –º–µ—Ä—Ç–≤–∏–π, –Ω–µ –º–∞–ª—é—î–º–æ
        if (!this.isAlive) return;
        
        // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
        ctx.save();
        
        // –≤–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ render –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–ª–∞—Å—É
        super.render(ctx);
        
        // –º–∞–ª—é—î–º–æ —á–µ—Ä–≤–æ–Ω–∏–π —Ö—Ä–µ—Å—Ç–∏–∫
        this.drawEnemyMark(ctx);
        
        // –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
        ctx.restore();
    }
    
    /**
     * –ú–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ–∑–Ω–∞—á–∫–∏ –≤–æ—Ä–æ–≥–∞ (—á–µ—Ä–≤–æ–Ω–∏–π —Ö—Ä–µ—Å—Ç–∏–∫)
     * @param {CanvasRenderingContext2D} ctx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
     */
    drawEnemyMark(ctx) {
        // —Ä–æ–∑–º—ñ—Ä –ø–æ–∑–Ω–∞—á–∫–∏ –≤ –ø—ñ–∫—Å–µ–ª—è—Ö
        const markSize = 6;
        // —Ü–µ–Ω—Ç—Ä —Ç–∞–Ω–∫–∞ –ø–æ X
        const centerX = this.x + this.width / 2;
        // —Ü–µ–Ω—Ç—Ä —Ç–∞–Ω–∫–∞ –ø–æ Y
        const centerY = this.y + this.height / 2;
        
        // —Ç–µ–º–Ω–æ-—á–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä –¥–ª—è –ª—ñ–Ω—ñ–π
        ctx.strokeStyle = darkGray;
        // —Ç–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π —Ö—Ä–µ—Å—Ç–∏–∫–∞
        ctx.lineWidth = 2;
        
        // –ø–æ—á–∏–Ω–∞—î–º–æ –º–∞–ª—é–≤–∞—Ç–∏ —à–ª—è—Ö
        ctx.beginPath();
        // –ø–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞
        ctx.moveTo(centerX - markSize, centerY - markSize);
        // –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞
        ctx.lineTo(centerX + markSize, centerY + markSize);
        // –º–∞–ª—é—î–º–æ –ª—ñ–Ω—ñ—é
        ctx.stroke();
        
        // –ø–æ—á–∏–Ω–∞—î–º–æ –º–∞–ª—é–≤–∞—Ç–∏ –Ω–æ–≤–∏–π —à–ª—è—Ö
        ctx.beginPath();
        // –ø–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞
        ctx.moveTo(centerX + markSize, centerY - markSize);
        // –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞
        ctx.lineTo(centerX - markSize, centerY + markSize);
        // –º–∞–ª—é—î–º–æ –ª—ñ–Ω—ñ—é
        ctx.stroke();
    }
}
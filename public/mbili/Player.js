import { Tank } from './Tank.js';
import { yellow, orange } from './colors.js';

/**
 * üéÆ –ö–ª–∞—Å Player - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –≥—Ä–∞–≤—Ü—è
 * 
 * –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞:
 * - –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –ª–æ–≥—ñ–∫—É –≥—Ä–∞–≤—Ü—è
 * - –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü–µ–º
 */

export class Player extends Tank {
    constructor(options = {}, logger) {
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–ª–∞—Å—É Tank
        super({
            ...options, // –ø–µ—Ä–µ–¥–∞—î–º–æ –≤—Å—ñ –æ–ø—Ü—ñ—ó –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–º—É –∫–ª–∞—Å—É
            // –∂–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
            color: options.color || yellow,
            // –≥—Ä–∞–≤–µ—Ü—å —Ä—É—Ö–∞—î—Ç—å—Å—è —à–≤–∏–¥—à–µ –∑–∞ –≤–æ—Ä–æ–≥–∞
            speed: options.speed || 2,
            // –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –Ω–∞–ø—Ä—è–º–æ–∫ –¥—É–ª–∞ –≤–≥–æ—Ä—É
            direction: options.direction || 'up'
        }, logger);
        
        // –õ–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å—É –ø–æ–¥—ñ–π –≥—Ä–∞–≤—Ü—è
        this.logger = logger;
        
        // –∑–∞–ø–∏—Å—É—î–º–æ –≤ –ª–æ–≥
        this.logger.playerAction('–ì—Ä–∞–≤–µ—Ü—å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π', `–ø–æ–∑–∏—Ü—ñ—è: (${this.x}, ${this.y})`);
    }
    
    /**
     * –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –≥—Ä–∞–≤—Ü—è
     * @param {number} deltaTime - –ß–∞—Å –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
     */
    update(deltaTime) {
        // –ü–æ–∫–∏ —â–æ –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å
        // –í –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —É—Ä–æ–∫–∞—Ö —Ç—É—Ç –±—É–¥–µ –ª–æ–≥—ñ–∫–∞ —Ä—É—Ö—É –∑–∞ –∫–ª–∞–≤—ñ—à–∞–º–∏
    }
    
    /**
     * –ú–∞–ª—é–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
     * @param {CanvasRenderingContext2D} ctx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
     */
    render(ctx) {
        // —è–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –º–µ—Ä—Ç–≤–∏–π, –Ω–µ –º–∞–ª—é—î–º–æ
        if (!this.isAlive) return;
        
        // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
        ctx.save();
        
        // –≤–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ render –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–ª–∞—Å—É
        super.render(ctx);
        
        // –º–∞–ª—é—î–º–æ –∂–æ–≤—Ç–∏–π –∫—Ä—É–≥
        this.drawPlayerMark(ctx);
        
        // –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
        ctx.restore();
    }
    
    /**
     * –ú–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ–∑–Ω–∞—á–∫–∏ –≥—Ä–∞–≤—Ü—è (–∂–æ–≤—Ç–∏–π –∫—Ä—É–≥)
     * @param {CanvasRenderingContext2D} ctx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
     */
    drawPlayerMark(ctx) {
        // —Ä–æ–∑–º—ñ—Ä –ø–æ–∑–Ω–∞—á–∫–∏ –≤ –ø—ñ–∫—Å–µ–ª—è—Ö
        const markSize = 4;
        // —Ü–µ–Ω—Ç—Ä —Ç–∞–Ω–∫–∞ –ø–æ X
        const centerX = this.x + this.width / 2;
        // —Ü–µ–Ω—Ç—Ä —Ç–∞–Ω–∫–∞ –ø–æ Y
        const centerY = this.y + this.height / 2;
        
        // –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–æ-–∂–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä
        ctx.fillStyle = orange;
        // –ø–æ—á–∏–Ω–∞—î–º–æ –º–∞–ª—é–≤–∞—Ç–∏ —à–ª—è—Ö
        ctx.beginPath();
        // –º–∞–ª—é—î–º–æ –∫–æ–ª–æ
        ctx.arc(centerX, centerY, markSize, 0, 2 * Math.PI);
        // –∑–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–ª–æ –∫–æ–ª—å–æ—Ä–æ–º
        ctx.fill();
    }
}
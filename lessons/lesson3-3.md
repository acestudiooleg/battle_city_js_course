# 3.3: –ö–ª–∞—Å –∫—É–ª—ñ üéØ

## –©–æ –º–∏ –±—É–¥–µ–º–æ —Ä–æ–±–∏—Ç–∏? üöÄ

–£ —Ü—å–æ–º—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ –º–∏ —Å—Ç–≤–æ—Ä–∏–º–æ –∫–ª–∞—Å `Bullet.js`, —è–∫–∏–π –±—É–¥–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∑–∞ –ª–æ–≥—ñ–∫—É –∫—É–ª—å, —ó—Ö —Ä—É—Ö —Ç–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è. –¶–µ —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–Ω–∞—Ä—è–¥–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ —Ç–∞–Ω–∫–∞!

## üîß –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—É Bullet.js

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `Bullet.js`:

```javascript
import { orange, red, white } from './colors.js';

/**
 * üéÆ –ö–ª–∞—Å Bullet - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫—É–ª—é
 *
 * –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞:
 * - –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó –∫—É–ª—ñ
 * - –†—É—Ö –∫—É–ª—ñ –≤ –∑–∞–¥–∞–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
 * - –ú–∞–ª—é–≤–∞–Ω–Ω—è –∫—É–ª—ñ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
 * - –ü–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–æ–ª—ñ–∑—ñ–π
 */

export class Bullet {
  constructor(options = {}, logger) {
    // –ü–æ–∑–∏—Ü—ñ—è –∫—É–ª—ñ
    this.x = options.x || 0;
    this.y = options.y || 0;

    // –†–æ–∑–º—ñ—Ä –∫—É–ª—ñ
    this.width = options.width || 4;
    this.height = options.height || 4;

    // –ù–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É
    this.direction = options.direction || 'up';

    // –®–≤–∏–¥–∫—ñ—Å—Ç—å –∫—É–ª—ñ
    this.speed = options.speed || 5;

    // –í–ª–∞—Å–Ω–∏–∫ –∫—É–ª—ñ ('player' –∞–±–æ 'enemy')
    this.owner = options.owner || 'player';

    // –ö–æ–ª—ñ—Ä –∫—É–ª—ñ
    this.color = this.owner === 'player' ? orange : red;

    // –°—Ç–∞–Ω –∫—É–ª—ñ
    this.isActive = true;

    // –ß–∞—Å –∂–∏—Ç—Ç—è –∫—É–ª—ñ (–≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö)
    this.lifetime = 3000; // 3 —Å–µ–∫—É–Ω–¥–∏
    this.age = 0;

    // –õ–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å—É –ø–æ–¥—ñ–π
    this.logger = logger;

    this.logger.gameEvent(
      '–ö—É–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–∞',
      `–≤–ª–∞—Å–Ω–∏–∫: ${this.owner}, –ø–æ–∑–∏—Ü—ñ—è: (${this.x}, ${this.y})`
    );
  }

  /**
   * –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∫—É–ª—ñ
   * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∫–æ–∂–µ–Ω –∫–∞–¥—Ä
   * @param {number} deltaTime - –ß–∞—Å –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
   */
  update(deltaTime) {
    if (!this.isActive) return;

    // –û–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å –∂–∏—Ç—Ç—è
    this.age += deltaTime;

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫—É–ª—è –Ω–µ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∞
    if (this.age >= this.lifetime) {
      this.destroy();
      return;
    }

    // –†—É—Ö–∞—î–º–æ –∫—É–ª—é
    this.move();
  }

  /**
   * –†—É—Ö –∫—É–ª—ñ –≤ –∑–∞–¥–∞–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
   */
  move() {
    switch (this.direction) {
      case 'up':
        this.y -= this.speed;
        break;
      case 'down':
        this.y += this.speed;
        break;
      case 'left':
        this.x -= this.speed;
        break;
      case 'right':
        this.x += this.speed;
        break;
    }
  }

  /**
   * –ú–∞–ª—é–≤–∞–Ω–Ω—è –∫—É–ª—ñ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
   * @param {CanvasRenderingContext2D} ctx - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
   */
  render(ctx) {
    if (!this.isActive) return;

    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    ctx.save();

    // –ú–∞–ª—é—î–º–æ –∫—É–ª—é —è–∫ –º–∞–ª–µ–Ω—å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);

    // –ú–∞–ª—é—î–º–æ —Ä–∞–º–∫—É –Ω–∞–≤–∫–æ–ª–æ –∫—É–ª—ñ
    ctx.strokeStyle = white;
    ctx.lineWidth = 1;
    ctx.strokeRect(this.x, this.y, this.width, this.height);

    // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    ctx.restore();
  }

  /**
   * –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫—É–ª—è –∞–∫—Ç–∏–≤–Ω–∞
   * @returns {boolean} - true —è–∫—â–æ –∫—É–ª—è –∞–∫—Ç–∏–≤–Ω–∞
   */
  isBulletActive() {
    return this.isActive;
  }

  /**
   * –ó–Ω–∏—â–µ–Ω–Ω—è –∫—É–ª—ñ
   */
  destroy() {
    this.isActive = false;
    this.logger.gameEvent('üí• –ö—É–ª—è –∑–Ω–∏—â–µ–Ω–∞');
  }

  /**
   * –û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ–∂ –∫—É–ª—ñ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–ª—ñ–∑—ñ–π
   * @returns {Object} - –û–±'—î–∫—Ç –∑ –º–µ–∂–∞–º–∏ –∫—É–ª—ñ
   */
  getBounds() {
    return {
      x: this.x,
      y: this.y,
      width: this.width,
      height: this.height,
    };
  }

  /**
   * –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–ª—ñ–∑—ñ—ó –∑ —ñ–Ω—à–∏–º –æ–±'—î–∫—Ç–æ–º
   * @param {Object} object - –û–±'—î–∫—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–ª—ñ–∑—ñ—ó
   * @returns {boolean} - true —è–∫—â–æ —î –∫–æ–ª—ñ–∑—ñ—è
   */
  checkCollision(object) {
    return (
      this.x < object.x + object.width &&
      this.x + this.width > object.x &&
      this.y < object.y + object.height &&
      this.y + this.height > object.y
    );
  }

  /**
   * –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫—É–ª—è –≤–∏–π—à–ª–∞ –∑–∞ –º–µ–∂—ñ –µ–∫—Ä–∞–Ω—É
   * @param {number} canvasWidth - –®–∏—Ä–∏–Ω–∞ Canvas
   * @param {number} canvasHeight - –í–∏—Å–æ—Ç–∞ Canvas
   * @returns {boolean} - true —è–∫—â–æ –∫—É–ª—è –∑–∞ –º–µ–∂–∞–º–∏ –µ–∫—Ä–∞–Ω—É
   */
  isOutOfBounds(canvasWidth, canvasHeight) {
    return (
      this.x < 0 || this.x > canvasWidth || this.y < 0 || this.y > canvasHeight
    );
  }

  /**
   * –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó –∫—É–ª—ñ
   * @param {number} x - –ù–æ–≤–∞ X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
   * @param {number} y - –ù–æ–≤–∞ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞
   */
  setPosition(x, y) {
    this.x = x;
    this.y = y;
  }

  /**
   * –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–ø—Ä—è–º–∫—É –∫—É–ª—ñ
   * @param {string} direction - –ù–∞–ø—Ä—è–º–æ–∫ ('up', 'down', 'left', 'right')
   */
  setDirection(direction) {
    this.direction = direction;
  }
}
```

## üéÆ –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –∫–ª–∞—Å?

### üîß –û—Å–Ω–æ–≤–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:

- **`x`, `y`** - –ø–æ–∑–∏—Ü—ñ—è –∫—É–ª—ñ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
- **`width`, `height`** - —Ä–æ–∑–º—ñ—Ä–∏ –∫—É–ª—ñ (4x4 –ø—ñ–∫—Å–µ–ª—ñ)
- **`direction`** - –Ω–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É –∫—É–ª—ñ
- **`speed`** - —à–≤–∏–¥–∫—ñ—Å—Ç—å —Ä—É—Ö—É (5 –ø—ñ–∫—Å–µ–ª—ñ–≤ –∑–∞ –∫–∞–¥—Ä)
- **`owner`** - –≤–ª–∞—Å–Ω–∏–∫ –∫—É–ª—ñ ('player' –∞–±–æ 'enemy')
- **`color`** - –∫–æ–ª—ñ—Ä –∫—É–ª—ñ (–∂–æ–≤—Ç–∏–π –¥–ª—è –≥—Ä–∞–≤—Ü—è, —á–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –≤–æ—Ä–æ–≥–∞)
- **`isActive`** - —á–∏ –∞–∫—Ç–∏–≤–Ω–∞ –∫—É–ª—è
- **`lifetime`** - —á–∞—Å –∂–∏—Ç—Ç—è –∫—É–ª—ñ (3 —Å–µ–∫—É–Ω–¥–∏)
- **`age`** - –ø–æ—Ç–æ—á–Ω–∏–π –≤—ñ–∫ –∫—É–ª—ñ

### ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏:

- **`update(deltaTime)`** - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∫—É–ª—ñ
- **`move()`** - —Ä—É—Ö –∫—É–ª—ñ –≤ –∑–∞–¥–∞–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
- **`render(ctx)`** - –º–∞–ª—é–≤–∞–Ω–Ω—è –∫—É–ª—ñ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
- **`destroy()`** - –∑–Ω–∏—â–µ–Ω–Ω—è –∫—É–ª—ñ
- **`checkCollision(object)`** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–ª—ñ–∑—ñ—ó
- **`isOutOfBounds()`** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Ö–æ–¥—É –∑–∞ –º–µ–∂—ñ –µ–∫—Ä–∞–Ω—É

## üöÄ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä—É—Ö—É

### üß≠ –ù–∞–ø—Ä—è–º–∫–∏ —Ä—É—Ö—É:

- **`up`** - —Ä—É—Ö –≤–≥–æ—Ä—É (–∑–º–µ–Ω—à–µ–Ω–Ω—è Y)
- **`down`** - —Ä—É—Ö –≤–Ω–∏–∑ (–∑–±—ñ–ª—å—à–µ–Ω–Ω—è Y)
- **`left`** - —Ä—É—Ö –≤–ª—ñ–≤–æ (–∑–º–µ–Ω—à–µ–Ω–Ω—è X)
- **`right`** - —Ä—É—Ö –≤–ø—Ä–∞–≤–æ (–∑–±—ñ–ª—å—à–µ–Ω–Ω—è X)

### ‚ö° –®–≤–∏–¥–∫—ñ—Å—Ç—å:

- **5 –ø—ñ–∫—Å–µ–ª—ñ–≤ –∑–∞ –∫–∞–¥—Ä** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- **–ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `speed`

## üé® –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –º–∞–ª—é–≤–∞–Ω–Ω—è

### üé® –í—ñ–∑—É–∞–ª—å–Ω–∏–π —Å—Ç–∏–ª—å:

- **–ú–∞–ª–µ–Ω—å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç** 4x4 –ø—ñ–∫—Å–µ–ª—ñ
- **–ö–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–ª–∞—Å–Ω–∏–∫–∞**:
  - –ñ–æ–≤—Ç–∏–π (`#f39c12`) –¥–ª—è –≥—Ä–∞–≤—Ü—è
  - –ß–µ—Ä–≤–æ–Ω–∏–π (`#e74c3c`) –¥–ª—è –≤–æ—Ä–æ–≥–∞
- **–ë—ñ–ª–∞ —Ä–∞–º–∫–∞** –Ω–∞–≤–∫–æ–ª–æ –∫—É–ª—ñ

### üîÑ –ü–æ—Ä—è–¥–æ–∫ –º–∞–ª—é–≤–∞–Ω–Ω—è:

1. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É** (`ctx.save()`)
2. **–ú–∞–ª—é–≤–∞–Ω–Ω—è –∫–≤–∞–¥—Ä–∞—Ç–∞** (`fillRect()`)
3. **–ú–∞–ª—é–≤–∞–Ω–Ω—è —Ä–∞–º–∫–∏** (`strokeRect()`)
4. **–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É** (`ctx.restore()`)

## ‚è∞ –°–∏—Å—Ç–µ–º–∞ –∂–∏—Ç—Ç—è –∫—É–ª—ñ

### üïê –ß–∞—Å –∂–∏—Ç—Ç—è:

- **3 —Å–µ–∫—É–Ω–¥–∏** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–Ω–∏—â–µ–Ω–Ω—è** –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —á–∞—Å—É
- **–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤—ñ–∫—É** –∫—É–ª—ñ

### üí• –£–º–æ–≤–∏ –∑–Ω–∏—â–µ–Ω–Ω—è:

1. **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–∞—Å—É –∂–∏—Ç—Ç—è** (`age >= lifetime`)
2. **–í–∏—Ö—ñ–¥ –∑–∞ –º–µ–∂—ñ –µ–∫—Ä–∞–Ω—É** (`isOutOfBounds()`)
3. **–ö–æ–ª—ñ–∑—ñ—è –∑ –æ–±'—î–∫—Ç–æ–º** (—á–µ—Ä–µ–∑ `checkCollision()`)

## üéØ –°–∏—Å—Ç–µ–º–∞ –∫–æ–ª—ñ–∑—ñ–π

### üîç –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:

```javascript
this.x < object.x + object.width &&
  this.x + this.width > object.x &&
  this.y < object.y + object.height &&
  this.y + this.height > object.y;
```

### üéØ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑ —Ç–∞–Ω–∫–∞–º–∏** (–≥—Ä–∞–≤–µ—Ü—å, –≤–æ—Ä–æ–≥)
- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑ –ø–µ—Ä–µ—à–∫–æ–¥–∞–º–∏** (—Å—Ç—ñ–Ω–∏, –±–ª–æ–∫–∏)
- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑ —ñ–Ω—à–∏–º–∏ –∫—É–ª—è–º–∏**

## üíª –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```javascript
// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—É–ª—ñ –≥—Ä–∞–≤—Ü—è –∑ –ª–æ–≥–≥–µ—Ä–æ–º
const playerBullet = new Bullet(
  {
    x: 100,
    y: 100,
    direction: 'up',
    owner: 'player',
    speed: 6,
  },
  logger
);

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—É–ª—ñ –≤–æ—Ä–æ–≥–∞ –∑ –ª–æ–≥–≥–µ—Ä–æ–º
const enemyBullet = new Bullet(
  {
    x: 300,
    y: 200,
    direction: 'down',
    owner: 'enemy',
    speed: 4,
  },
  logger
);

// –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É–ª—ñ
playerBullet.update(deltaTime);

// –ú–∞–ª—é–≤–∞–Ω–Ω—è –∫—É–ª—ñ
playerBullet.render(ctx);

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–ª—ñ–∑—ñ—ó
if (playerBullet.checkCollision(enemy)) {
  playerBullet.destroy();
  enemy.takeDamage();
}
```

## üìù –ü–∞—Ä–∞–º–µ—Ç—Ä logger

**`logger`** - –æ–±'—î–∫—Ç —Å–∏—Å—Ç–µ–º–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –∑–∞–ø–∏—Å—É –ø–æ–¥—ñ–π –∫—É–ª—å. 

–î–∏–≤. [–£—Ä–æ–∫ 2.8: –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è](/lessons/lesson2-8.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É.

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ü—å–æ–≥–æ –∫–ª–∞—Å—É —É –≤–∞—Å –±—É–¥–µ:

- ‚úÖ –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫—É–ª—å
- ‚úÖ –†—É—Ö —É –≤—Å—ñ—Ö –Ω–∞–ø—Ä—è–º–∫–∞—Ö
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–æ–ª—ñ–∑—ñ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–Ω–∏—â–µ–Ω–Ω—è
- ‚úÖ –í—ñ–∑—É–∞–ª—å–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –∫—É–ª—è–º–∏ –≥—Ä–∞–≤—Ü—è —Ç–∞ –≤–æ—Ä–æ–≥–∞

## üöÄ –©–æ –¥–∞–ª—ñ?

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –æ–Ω–æ–≤–∏–º–æ –∫–ª–∞—Å –≥—Ä–∞–≤—Ü—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä—É—Ö—É –∑–∞ –∫–ª–∞–≤—ñ—à–∞–º–∏.

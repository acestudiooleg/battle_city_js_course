# 2.7: –ú–æ—Ç–æ—Ä –≥—Ä–∏

## –©–æ –º–∏ –±—É–¥–µ–º–æ —Ä–æ–±–∏—Ç–∏?

–£ —Ü—å–æ–º—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ –º–∏ —Å—Ç–≤–æ—Ä–∏–º–æ –∫–ª–∞—Å `Game.js`, —è–∫–∏–π –±—É–¥–µ –≥–æ–ª–æ–≤–Ω–∏–º –∫–ª–∞—Å–æ–º –≥—Ä–∏, —â–æ –∫–æ–æ—Ä–¥–∏–Ω—É—î –≤—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ç–∞ –∫–µ—Ä—É—î —ñ–≥—Ä–æ–≤–∏–º —Ü–∏–∫–ª–æ–º.

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—É Game.js

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `Game.js`:

```javascript
/**
 * üéÆ –ö–ª–∞—Å Game - –≥–æ–ª–æ–≤–Ω–∏–π –∫–ª–∞—Å –≥—Ä–∏
 * 
 * –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞:
 * - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –≥—Ä–∏
 * - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —ñ–≥—Ä–æ–≤–∏–º —Ü–∏–∫–ª–æ–º
 * - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—é –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ —á–∞—Å—Ç–∏–Ω–∞–º–∏ –≥—Ä–∏
 */

import { canvas, ctx, GAME_CONFIG, logger } from './main.js';
import { Player } from './Player.js';
import { Enemy } from './Enemy.js';
import { GameField } from './GameField.js';

export class Game {
    constructor() {
        // Canvas –µ–ª–µ–º–µ–Ω—Ç –∑ HTML
        this.canvas = canvas;
        // –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
        this.ctx = ctx;
        // –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≥—Ä–∏
        this.config = GAME_CONFIG;
        
        // –≥—Ä–∞–≤–µ—Ü—å (–ø–æ–∫–∏ —â–æ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π)
        this.player = null;
        // –≤–æ—Ä–æ–≥ (–ø–æ–∫–∏ —â–æ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π)
        this.enemy = null;
        // —ñ–≥—Ä–æ–≤–µ –ø–æ–ª–µ (–ø–æ–∫–∏ —â–æ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–µ)
        this.gameField = null;
        
        // —á–∏ –∑–∞–ø—É—â–µ–Ω–∞ –≥—Ä–∞
        this.isRunning = false;
        // —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∫–∞–¥—Ä—É
        this.lastTime = 0;
    }
    
    /**
     * –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
     * –°—Ç–≤–æ—Ä—é—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –æ–±'—î–∫—Ç–∏
     */
    init() {
        // –∑–∞–ø–∏—Å—É—î–º–æ –≤ –ª–æ–≥
        logger.gameEvent('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏');
        
        // —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–µ —ñ–≥—Ä–æ–≤–µ –ø–æ–ª–µ
        this.gameField = new GameField(this.ctx, this.config);
        
        this.player = new Player({
            // –ø–æ–∑–∏—Ü—ñ—è X –≥—Ä–∞–≤—Ü—è
            x: 100,
            // –ø–æ–∑–∏—Ü—ñ—è Y –≥—Ä–∞–≤—Ü—è
            y: 100,
            // –∂–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä –¥–ª—è –≥—Ä–∞–≤—Ü—è
            color: '#f1c40f',
            // —Ä–æ–∑–º—ñ—Ä —Ç–∞–Ω–∫–∞
            size: this.config.TILE_SIZE
        });
        
        this.enemy = new Enemy({
            // –ø–æ–∑–∏—Ü—ñ—è X –≤–æ—Ä–æ–≥–∞
            x: 300,
            // –ø–æ–∑–∏—Ü—ñ—è Y –≤–æ—Ä–æ–≥–∞
            y: 200,
            // —á–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä –¥–ª—è –≤–æ—Ä–æ–≥–∞
            color: '#e74c3c',
            // —Ä–æ–∑–º—ñ—Ä —Ç–∞–Ω–∫–∞
            size: this.config.TILE_SIZE
        });
        
        // –∑–∞–ø–∏—Å—É—î–º–æ —É—Å–ø—ñ—Ö –≤ –ª–æ–≥
        logger.success('–ì—Ä–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!');
    }
    
    /**
     * –ó–∞–ø—É—Å–∫ –≥—Ä–∏
     */
    start() {
        // –ø–æ–∑–Ω–∞—á–∞—î–º–æ –≥—Ä—É —è–∫ –∑–∞–ø—É—â–µ–Ω—É
        this.isRunning = true;
        // –∑–∞–ø—É—Å–∫–∞—î–º–æ —ñ–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª
        this.gameLoop();
        // –∑–∞–ø–∏—Å—É—î–º–æ –≤ –ª–æ–≥
        logger.gameEvent('–ì—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
    }
    
    /**
     * –ó—É–ø–∏–Ω–∫–∞ –≥—Ä–∏
     */
    stop() {
        // –ø–æ–∑–Ω–∞—á–∞—î–º–æ –≥—Ä—É —è–∫ –∑—É–ø–∏–Ω–µ–Ω—É
        this.isRunning = false;
        // –∑–∞–ø–∏—Å—É—î–º–æ –≤ –ª–æ–≥
        logger.gameEvent('–ì—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞!');
    }
    
    /**
     * –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –≥—Ä–∏
     * @param {number} deltaTime - –ß–∞—Å –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
     */
    update(deltaTime) {
        // –æ–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –ø–æ–ª—è
        this.gameField.update(deltaTime);
        
        // –æ–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –≥—Ä–∞–≤—Ü—è
        this.player.update(deltaTime);
        
        // –æ–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –≤–æ—Ä–æ–≥–∞
        this.enemy.update(deltaTime);
    }
    
    /**
     * –ú–∞–ª—é–≤–∞–Ω–Ω—è –≥—Ä–∏
     */
    render() {
        // –≤–∏–¥–∞–ª—è—î–º–æ –≤—Å–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –º–∞–ª—é–≤–∞–Ω–Ω—è
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // –º–∞–ª—é—î–º–æ —Ñ–æ–Ω —Ç–∞ —Å—ñ—Ç–∫—É
        this.gameField.render();
        
        // –º–∞–ª—é—î–º–æ –∂–æ–≤—Ç–∏–π —Ç–∞–Ω–∫ –≥—Ä–∞–≤—Ü—è
        this.player.render(this.ctx);
        
        // –º–∞–ª—é—î–º–æ —á–µ—Ä–≤–æ–Ω–∏–π —Ç–∞–Ω–∫ –≤–æ—Ä–æ–≥–∞
        this.enemy.render(this.ctx);
    }
    
    /**
     * –ì–æ–ª–æ–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª
     * @param {number} currentTime - –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å
     */
    gameLoop(currentTime = 0) {
        // —è–∫—â–æ –≥—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞, –≤–∏—Ö–æ–¥–∏–º–æ
        if (!this.isRunning) return;
        
        // —Ä—ñ–∑–Ω–∏—Ü—è —á–∞—Å—É –º—ñ–∂ –∫–∞–¥—Ä–∞–º–∏
        const deltaTime = currentTime - this.lastTime;
        // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å
        this.lastTime = currentTime;
        
        // –æ–Ω–æ–≤–ª—é—î–º–æ –≤—Å—ñ –æ–±'—î–∫—Ç–∏ –≥—Ä–∏
        this.update(deltaTime);
        
        // –º–∞–ª—é—î–º–æ –≤—Å–µ –Ω–∞ Canvas
        this.render();
        
        // –ø–ª–∞–Ω—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–∞–¥—Ä
        requestAnimationFrame((time) => this.gameLoop(time));
    }
}
```

## –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –∫–ª–∞—Å?

### –û—Å–Ω–æ–≤–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:
- **`canvas`** - HTML Canvas –µ–ª–µ–º–µ–Ω—Ç
- **`ctx`** - –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
- **`config`** - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≥—Ä–∏
- **`player`** - –æ–±'—î–∫—Ç –≥—Ä–∞–≤—Ü—è
- **`enemy`** - –æ–±'—î–∫—Ç –≤–æ—Ä–æ–≥–∞
- **`gameField`** - –æ–±'—î–∫—Ç —ñ–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
- **`isRunning`** - —á–∏ –∑–∞–ø—É—â–µ–Ω–∞ –≥—Ä–∞
- **`lastTime`** - —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∫–∞–¥—Ä—É

### –û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏:
- **`init()`** - —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- **`start()`** - –∑–∞–ø—É—Å–∫ –≥—Ä–∏
- **`stop()`** - –∑—É–ø–∏–Ω–∫–∞ –≥—Ä–∏
- **`update(deltaTime)`** - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤
- **`render()`** - –º–∞–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤
- **`gameLoop(currentTime)`** - –≥–æ–ª–æ–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª

## –Ü–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–∏–∫–ª—É:
1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É** - —á–∏ –≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞
2. **–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–∞—Å—É** - —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –∫–∞–¥—Ä–∞–º–∏
3. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è** - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤
4. **–ú–∞–ª—é–≤–∞–Ω–Ω—è** - –º–∞–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤
5. **–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è** - –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫–∞–¥—Ä—É

### –ü–æ—Ä—è–¥–æ–∫ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:
1. **–Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ** - `gameField.update()`
2. **–ì—Ä–∞–≤–µ—Ü—å** - `player.update()`
3. **–í–æ—Ä–æ–≥** - `enemy.update()`

### –ü–æ—Ä—è–¥–æ–∫ –º–∞–ª—é–≤–∞–Ω–Ω—è:
1. **–û—á–∏—â–µ–Ω–Ω—è Canvas** - `clearRect()`
2. **–Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ** - `gameField.render()`
3. **–ì—Ä–∞–≤–µ—Ü—å** - `player.render()`
4. **–í–æ—Ä–æ–≥** - `enemy.render()`

## –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –æ–±'—î–∫—Ç—ñ–≤

### –ü–æ–∑–∏—Ü—ñ—ó —Ç–∞–Ω–∫—ñ–≤:
- **–ì—Ä–∞–≤–µ—Ü—å**: (100, 100) - –∂–æ–≤—Ç–∏–π —Ç–∞–Ω–∫
- **–í–æ—Ä–æ–≥**: (300, 200) - —á–µ—Ä–≤–æ–Ω–∏–π —Ç–∞–Ω–∫

### –†–æ–∑–º—ñ—Ä–∏:
- **–¢–∞–Ω–∫–∏**: 32x32 –ø—ñ–∫—Å–µ–ª—ñ (—Ä–æ–∑–º—ñ—Ä –∫–ª—ñ—Ç–∏–Ω–∫–∏)
- **Canvas**: 800x600 –ø—ñ–∫—Å–µ–ª—ñ–≤

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```javascript
// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∏
const game = new Game();

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
game.init();

// –ó–∞–ø—É—Å–∫ –≥—Ä–∏
game.start();

// –ó—É–ø–∏–Ω–∫–∞ –≥—Ä–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
// game.stop();
```

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–ö–ª–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ª–æ–≥—É—î:
- **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –≥—Ä–∏** - `gameEvent('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏')`
- **–£—Å–ø—ñ—à–Ω—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é** - `success('–ì—Ä–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!')`
- **–ó–∞–ø—É—Å–∫ –≥—Ä–∏** - `gameEvent('–ì—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!')`
- **–ó—É–ø–∏–Ω–∫—É –≥—Ä–∏** - `gameEvent('–ì—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞!')`

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

### requestAnimationFrame:
- **–ü–ª–∞–≤–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è** - 60 FPS
- **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è** - –±—Ä–∞—É–∑–µ—Ä —Å–∞–º –∫–µ—Ä—É—î —á–∞—Å—Ç–æ—Ç–æ—é
- **–ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤** - –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è –∫–æ–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞

### deltaTime:
- **–ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ FPS** - —Ä—É—Ö –±—É–¥–µ –æ–¥–Ω–∞–∫–æ–≤–∏–º –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö
- **–ü–ª–∞–≤–Ω—ñ—Å—Ç—å** - –∫–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—è –∑–º—ñ–Ω —á–∞—Å—Ç–æ—Ç–∏ –∫–∞–¥—Ä—ñ–≤

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ü—å–æ–≥–æ –∫–ª–∞—Å—É —É –≤–∞—Å –±—É–¥–µ:
- ‚úÖ –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π –¥–≤–∏–∂–æ–∫
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- ‚úÖ –ü–ª–∞–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª
- ‚úÖ –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π

## –©–æ –¥–∞–ª—ñ?

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –æ–Ω–æ–≤–∏–º–æ –≥–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª `main.js` –¥–ª—è –∑–∞–ø—É—Å–∫—É –≤—Å—ñ—î—ó –≥—Ä–∏. 